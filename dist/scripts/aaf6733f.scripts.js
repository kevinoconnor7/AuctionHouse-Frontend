(function(){"use strict";var a;a=angular.module("penelophantFrontendApp",["ngCookies","ngResource","ngSanitize","ngRoute","restangular","mgo-angular-wizard","flatui.radioButton","ui.bootstrap.datetimepicker","angularMoment","ui.bootstrap","btford.markdown"]),a.config(["$routeProvider","RestangularProvider",function(a,b){return b.setBaseUrl("/api"),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"PwdAuthCtrl"}).when("/auctions",{templateUrl:"views/auctions/index.html",controller:"AuctionsListCtrl"}).when("/auctions/add",{templateUrl:"views/auctions/add.html",controller:"AuctionsAddCtrl",loggedIn:!0}).when("/auctions/:id",{templateUrl:"views/auctions/view.html",controller:"AuctionsViewCtrl"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl",loggedIn:!0}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/invoices",{templateUrl:"views/invoices/index.html",controller:"InvoicesListCtrl"}).when("/invoices/:id",{templateUrl:"views/invoices/view.html",controller:"InvoicesViewCtrl"}).otherwise({redirectTo:"/"})}]),a.run(["$rootScope","Restangular","AuthService","$location","$q",function(a,b,c,d,e){return b.addFullRequestInterceptor(function(){return{headers:{Authorization:"Bearer "+c.getToken()}}}),c.loadToken(),a.current_user=c,a.$on("$routeChangeSuccess",function(b,c){return c.$$route&&c.$$route.controller?a.controller=c.$$route.controller:void 0}),a.$on("$routeChangeStart",function(a,b){return b.resolve=angular.extend(b.resolve||{},{_auth_:function(){var a;return a=e.defer(),c.resolve().then(function(){return a.resolve(c)},function(){return b.loggedIn!==!0||c.isLoggedIn()||d.path("/login"),a.resolve(c)}),a.promise}})})}])}).call(this),function(){"use strict";angular.module("flatui.radioButton",[]),angular.module("flatui.radioButton").controller("FlatUIRadioButtonController",["$scope",function(a){return console.log(a),a.checked=function(){return a.value===a.model}}]),angular.module("flatui.radioButton").directive("flatuiradiobutton",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=",label:"=",value:"=",required:"=",name:"="},templateUrl:"views/contrib/flat-ui/flatui-radio-button-template.html",controller:"FlatUIRadioButtonController"}})}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").controller("AuctionsListCtrl",["$scope","Restangular","$location",function(a,b,c){a.auctions=b.all("auctions").getList(c.search()).$object}]),angular.module("penelophantFrontendApp").controller("AuctionsAddCtrl",["$scope","Restangular","$routeParams","$location",function(a,b,c,d){a.auction={start_time:moment().toString(),end_time:moment().add("days",7).toString(),start_price:0,reserve:0},a.auctionTypes=b.all("auctions/types").getList().$object,a.alerts=[],a.checkAuctionType=function(b,c){var d,e,f,g;if(!b||!c.type)return!1;for(g=a.auctionTypes,e=0,f=g.length;f>e;e++)if(d=g[e],d.type===c.type)return!0;return!1},a.addAuction=function(c){var e;return e=b.all("auctions").post({type:c.type,title:c.title,description:c.description,start_price:c.start_price,reserve:c.reserve,start_time:moment.utc(c.start_time).unix(),end_time:moment.utc(c.end_time).unix()}).then(function(a){return d.path("/auctions/"+a.id)},function(b){return a.alerts=[],a.alerts.push({title:"Oh no!",msg:b.data.message,type:"danger"})})}}]),angular.module("penelophantFrontendApp").controller("AuctionsViewCtrl",["$scope","Restangular","$routeParams","AuthService",function(a,b,c,d){var e;e=function(){return a.auction=b.one("auctions",parseInt(c.id,10)).get().$object},e(),a.alerts=[],a.formatTime=function(a){return moment(a).format("MMMM Do YYYY, h:mm:ss a")},a.postBid=function(b,c){return d.isLoggedIn()&&b&&c?a.auction.post("bid",c).then(function(b){return a.alerts=[],a.alerts.push({title:"Sweet!",msg:"Your bid for $"+b.price+" was entered",type:"success"}),c.price=null,e()},function(b){return a.alerts=[],a.alerts.push({title:"Oh no!",msg:b.data.message,type:"danger"})}):void 0}}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").controller("InvoicesListCtrl",["$scope","Restangular",function(a,b){return a.invoices=b.all("invoices").getList().$object}]),angular.module("penelophantFrontendApp").controller("InvoicesViewCtrl",["$scope","Restangular","$routeParams","Balanced",function(a,b,c,d){var e;return a.alerts=[],e=function(){return a.invoice=b.one("invoices",parseInt(c.id,10)).get().$object},e(),a.closeAlert=function(b){return a.alerts.splice(b,1)},a.balanced=d,a.payCC=function(b){var c,e,f,g,h;if(b||(b={}),f={number:b.number||0,name:b.name||"",expiration_month:b.expiration_month||0,expiration_year:b.expiration_year||0,security_code:b.security_code||0},a.alerts=[],e=d.validateCC(f),!(e.length>0))return d.createCard(f).then(function(b){var d,e,f,g;if(b.errors){for(f=b.error,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(a.alerts.push({msg:c.description,type:"danger"}));return g}return b.card?a.invoice.put({ccId:b.card.id}).then(function(b){return a.invoice=b}):a.alerts.push({msg:"Ruh-roh. Something went wrong. You might want to try again.",type:"danger"})});for(g=0,h=e.length;h>g;g++)c=e[g],a.alerts.push({type:"danger",msg:c.description.split(" - ",2)[1]})}}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").controller("LogoutCtrl",["$scope","AuthService","$location",function(a,b,c){return b.logout(),c.path("/")}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").controller("MainCtrl",["$scope",function(a){return a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").controller("NavCtrl",["$scope","AuthService","$location","$rootScope",function(a,b,c,d){return a.current_user=b.user,d.$on("$routeChangeSuccess",function(b,c){return c.$$route&&c.$$route.controller&&"AuctionsListCtrl"===c.$$route.controller?void 0:a.q&&a.q.query?a.q.query=null:void 0}),a.search=function(a){return c.path("/auctions").search(a)}}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").controller("PwdAuthCtrl",["$scope","Restangular","AuthService","$location",function(a,b,c,d){var e,f;return c.isLoggedIn()?d.path("/"):(e=null,f=function(){return a.alert={type:"danger",msg:"We were not able to validate these credentials"}},a.auth=function(e,g){return e?b.all("auth").customPOST({email:g.email,password:g.password},"password").then(function(b){return a.current_user=c,a.current_user.setUser(b),d.path("/")},function(){return f()}):f()})}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").controller("RegisterCtrl",["$scope","AuthService","Restangular","$location",function(a,b,c,d){var e,f;return b.isLoggedIn()?d.path("/"):(a.registerAlerts=[],e=null,f=function(){return a.registerAlerts=[],a.registerAlerts.push({msg:"We weren't able to create you an account. Do you already have an account?",title:"Ruh-roh!",type:"danger"})},a.register=function(a,e){return a?c.all("users").post(e).then(function(a){return b.setUser({token:a.token,user:a.user}),c.all("auth").customOperation("put","password",null,null,e).then(function(){return d.path("/")},function(){return console.log("oh shit!"),f()})},function(){return f()}):f()})}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").directive("requireLoggedIn",["AuthService",function(a){return{restrict:"A",link:function(b,c){var d;return d=c.css("display"),b.current_user=a,b.$watch("current_user.loggedIn",function(){return b.current_user.isLoggedIn()?c.css("display",d):c.css("display","none")})}}}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").directive("creditCardNumber",["Balanced",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){var f;return f=function(b){return e.$setValidity("creditCardNumber",a.isCardNumberValid(b))},b.$watch(function(){return e.$viewValue},f)}}}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").service("AuthService",["Restangular","$window","$timeout","$q",function(a,b,c,d){return{loggedIn:!1,user:null,token:null,triedToken:!1,logout:function(){return this.loggedIn=!1,this.user=null,this.token=null,b.sessionStorage.removeItem("token")},isLoggedIn:function(){return this.loggedIn},setUser:function(c){return this.token=c.token,this.loggedIn=!0,this.user=c.user,b.sessionStorage.token=c.token,a.addFullRequestInterceptor(function(a){return function(){return{headers:{Authorization:"Bearer "+a.getToken()}}}}(this))},getToken:function(){return!this.token&&b.sessionStorage.token?b.sessionStorage.token:this.token},verifyToken:function(){return a.one("token").get().then(function(a){return function(b){return a.triedToken=!0,a.setUser(b)}}(this),function(a){return function(){return a.triedToken=!0,b.sessionStorage.removeItem("token")}}(this))},resolve:function(){var c,e;return c=d.defer(),e=this.triedToken,this.triedToken=!0,this.loggedIn?c.resolve(this):e?c.reject():a.one("token").get().then(function(a){return function(b){return a.setUser(b),c.resolve(a)}}(this),function(){return b.sessionStorage.removeItem("token"),c.reject()}),c.promise},loadToken:function(){return this.loggedIn?void 0:b.sessionStorage.token?this.verifyToken(b.sessionStorage.token):void 0}}}])}.call(this),function(){"use strict";angular.module("penelophantFrontendApp").service("Balanced",["$q",function(a){return{handleResponse:function(a,b){return b.resolve(201!==a.status_code?{errors:a.errors}:{card:a.cards[0]})},getCardType:function(a){return balanced.card.cardType(a)},isCardNumberValid:function(a){return balanced.card.isCardNumberValid(a)},isCVVValid:function(a,b){return balanced.card.isCVVValid(a,b)},isExpiryValid:function(a,b){return balanced.card.isExpiryValid(a,b)},validateCC:function(a){return balanced.card.validate(a)},isRoutingNumberValid:function(a){return balanced.bankAccount.isRoutingNumberValid(a)},validateBA:function(a){return balanced.bankAccount.validateBA(a)},createCard:function(b){var c;return c=a.defer(),b||c.reject(),balanced.card.create(b,function(a){return function(b){return a.handleResponse(b,c)}}(this)),c.promise},createBankAccount:function(b){var c;return c=a.defer(),b||c.reject(),balanced.bankAccount.create(b,function(a){return function(b){return a.handleResponse(b,c)}}(this)),c.promise}}}])}.call(this);